<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alibaba Video Finder</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#0b0b0f; color:#eee; margin:0; }
    .wrap { max-width: 980px; margin: 40px auto; padding: 24px; }
    h1 { font-size: 1.7rem; margin: 0 0 6px; }
    p { color:#b9bcc6; margin-top:0; }
    .card { background:#141420; border:1px solid #23233a; border-radius:16px; padding:16px; box-shadow:0 8px 30px rgba(0,0,0,.35);}
    input { width:100%; padding:12px 14px; border-radius:12px; border:1px solid #2b2b45; background:#0f0f18; color:#fff; font-size:1rem; }
    button { margin-top:12px; padding:10px 14px; border-radius:12px; border:0; background:#7b1b1b; color:#fff; font-weight:600; cursor:pointer; }
    .status { margin-top:10px; font-size:.95rem; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:14px; margin-top:14px;}
    .vid { background:#0f0f18; border:1px solid #2b2b45; border-radius:14px; padding:10px;}
    .vid video { width:100%; border-radius:10px; background:#000; }
    .u { font-size:.8rem; color:#9aa0ac; word-break:break-all; margin:6px 0; }
    .row { display:flex; gap:8px; flex-wrap:wrap;}
    .tag { font-size:.75rem; color:#ccc; padding:2px 6px; background:#22223a; border-radius:999px;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Alibaba Video Finder</h1>
    <p>Paste a product page. It pulls any publicly available videos and lets you download them.</p>

    <div class="card">
      <input id="pageUrl" placeholder="Paste Alibaba product URL here" />
      <button id="go">Find videos</button>
      <div id="status" class="status"></div>
      <div id="results" class="grid"></div>
    </div>
  </div>

<script>
  const pageUrl = document.getElementById("pageUrl");
  const go = document.getElementById("go");
  const statusEl = document.getElementById("status");
  const resultsEl = document.getElementById("results");

  function setStatus(msg){ statusEl.textContent = msg; }

  function filenameFromUrl(u){
    try{
      const url = new URL(u);
      const name = (url.pathname.split("/").pop() || "video.mp4").split("?")[0];
      return name.includes(".") ? name : (name + ".mp4");
    }catch{ return "video.mp4"; }
  }

  go.onclick = async () => {
    const u = pageUrl.value.trim();
    if(!u) return setStatus("Paste a link first.");

    resultsEl.innerHTML = "";
    setStatus("Loading page and sniffing videos...");

    try{
      const r = await fetch(`/extract?url=${encodeURIComponent(u)}`);
      const data = await r.json();

      if(!data.videos || data.videos.length === 0){
        setStatus("No public videos found on that page.");
        return;
      }

      setStatus(`Found ${data.videos.length} video(s).`);

      data.videos.forEach((v) => {
        const div = document.createElement("div");
        div.className = "vid";

        const tag = document.createElement("div");
        tag.className = "row";
        tag.innerHTML = `<span class="tag">${v.type.toUpperCase()}</span>`;
        div.appendChild(tag);

        const video = document.createElement("video");
        video.controls = true;
        video.playsInline = true;
        video.src = v.url;
        div.appendChild(video);

        const urlP = document.createElement("div");
        urlP.className="u";
        urlP.textContent = v.url;
        div.appendChild(urlP);

        const dlBtn = document.createElement("button");
        dlBtn.textContent = "Download";
        dlBtn.onclick = () => {
          const name = filenameFromUrl(v.url);
          const a = document.createElement("a");
          a.href = `/download?url=${encodeURIComponent(v.url)}`;
          a.download = name;
          document.body.appendChild(a);
          a.click();
          a.remove();
        };
        div.appendChild(dlBtn);

        resultsEl.appendChild(div);
      });
    }catch(e){
      setStatus("Failed to extract videos. Try another link.");
    }
  };
</script>
</body>
</html>
